---
title: 旁路由
date: 2020-09-27 23:15:53
categories:
  - 软路由
tags:
  - 软路由
  - 网络配置
permalink: /pages/b89404/
---

简单说明一下怎么设置旁路由，发挥单网口设备的余热。

## 设备简介

这次演示用的旁路由为 OpenWrt 单网口设备，主路由不方便介绍。

## 旁路由设置

首先正常烧录镜像，不会的可以看[教程](../../03.装机/0010.安装系统/0010.烧录镜像.md)，然后正常登录软路由。

设置 LAN 口，修改 LAN 口 IP 为主路由网段下的 IP，修改网关为主路由。

![](./img/5f70b103160a154a67d52ec3.png)

点击保存，先不要点应用。

然后在 `物理设置` 选项卡中取消桥接，直接选择 LAN 网卡，然后保存。

![](./img/5f70b103160a154a67d52ec1.png)

修改防火墙设置，添加

```
iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE
```

![](./img/5f70b134160a154a67d53f05.png)

保存，然后点击右上角的未保存的配置，保存并应用。

如果不想要自己手动设置防火墙规则，可以使用 `防火墙` -> `通信规则` 里面的 SNAT 功能，设置如下图所示

![](./img/5fab9f1b1cd1bbb86bf9000e.png)

此时将软路由插到主路由上，并且使用刚才设置的软路由 IP，应该可以正常访问到软路由。

## 如何使用

上面旁路由已经设置完成了，但还是不能生效，我们还需要其他的设置才能使用，下面给出几种方法，任选一种即可。

### 手动指定网关和 DNS

这种方法适用于临时使用，或者是你不想影响其他人正常上网，是最简单，也是最麻烦的一直方法。

首先关闭旁路由的 DHCP

![](./img/5f70b134160a154a67d53f07.png)

然后在需要设置的电脑上，打开控制面板里的网络连接，然后手动设置 IP 和 DNS，其中网关需要设置为旁路由的 IP，这样运行在旁路由上的服务就可以在这台电脑上使用了。

![](./img/5f70b16f160a154a67d55178.png)

### 使用主路由的 DHCP

这是最常用的一种方法，需要关闭旁路由的 DHCP，并修改主路由的 DHCP 选项，设置默认网关和 DNS 服务器为旁路由。

我这里主路由不支持修改 DHCP 默认网关，就不放图了，具体可以百度 xxx 路由器修改 DHCP 网关。

OpenWrt 的修改方法可以参考下面。

### 使用旁路由的 DHCP

开启旁路由 DHCP，并且按图设置，指定网关和 DNS 为旁路由，并关闭主路由的 DHCP。

![](./img/5f70b16f160a154a67d5517d.png)

## 补充

经过以上设置之后，在旁路由搞去广告或者其他骚东西，就可以对下面的设备生效了，如果是长期使用，建议由旁路由接管 DHCP，为主路由分担压力。

### 端口映射

如果需要在主路由上，把端口映射到旁路由下的设备上，有两种办法，一种是将端口映射到旁路由，再从旁路由映射到设备，另一种是在主路由上做 ARP 绑定，具体设置方法和注意事项，请自行百度。

---
