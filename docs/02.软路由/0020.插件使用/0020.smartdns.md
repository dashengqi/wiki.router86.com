---
title: Smartdns使用
date: 2020-09-27 11:51:53
categories:
  - 软路由
tags:
  - 软路由
  - OpenWRT
  - 插件使用
permalink: /pages/a47ac6/
---

> 补充，目前(2021 年 9 月 1 日)来说，如果没有特殊情况，已经没有必要自己设置 DNS 相关的东西了。

## 介绍

[SmartDNS](https://pymumu.github.io/smartdns/)是一个运行在本地的 DNS 服务器，SmartDNS 接受本地客户端的 DNS 查询请求，从多个上游 DNS 服务器获取 DNS 查询结果，并将访问速度最快的结果返回给客户端，提高网络访问速度。 同时支持指定特定域名 IP 地址，并高性匹配，达到过滤广告的效果。

## 使用

### 设置上游

打开 SmartDNS 设置，添加上游。

![](./img/5f702cc2160a154a67a1e0d2.png)

上游服务器选择质量高的，不要贪多，质量不行，再多也没用，推荐在 8 个以内，不要超过 10 个。

设置完成后点击保存，先不要应用。

### 修改设置

![](./img/5f702cf2160a154a67a1eefd.png)

一般按照上图设置即可 缓存时间和 TTL 可以根据你的路由器性能来改。

设置完成后点击 `保存并应用` 即可。

因为是设置为 dnsmasq 的上游，我们可以在 dnsmasq 那里看一下设置对不对，正常可以看到。

![](./img/5f702ddb160a154a67a221f7.png)

转发设置的第一条，被转到了 smartdns 的端口上。

## Passwall + SmartDNS

首先正常设置国内的上游服务器，接下来设置国外的上游服务器，有几点要注意一下

- 协议要选择 tcp tls 和 https ，并且要选择支持这些协议的 dns 服务器
- 添加完成后点击修改，在服务器组那里添加上一个统一的名称

![](./img/5f702dfa160a154a67a228de.png)

然后设置第二 DNS 服务器，端口设置为 7913，服务器组填写刚才设置的名称，其他的建议和我的一样。

![](./img/5f702e79160a154a67a2418f.png)

然后来到 Passwall 设置，直接看图

![](./img/5f702ead160a154a67a24d12.png)

然后来到访问控制这里，把国内 DNS 的 IP 全部加入白名单，国外 DNS 的 IP 和域名全部加入黑名单（不要光看图，图只是示例）。

![](./img/5f702ecd160a154a67a2531e.png)

![](./img/5f702f31160a154a67a26add.png)

---
